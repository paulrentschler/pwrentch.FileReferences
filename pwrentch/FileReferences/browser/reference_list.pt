<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      metal:use-macro="context/main_template/macros/master">

  <metal:override fill-slot="top_slot"
                  tal:define="disable_column_one python:request.set('disable_plone.leftcolumn', 1);
                              disable_column_two python:request.set('disable_plone.rightcolumn', 1);"
                  />

  <metal:styles fill-slot="style_slot">
    <link rel="stylesheet" type="text/css"
          tal:define="navroot context/@@plone_portal_state/navigation_root_url"
          tal:attributes="href string:${navroot}/++resource++pwrentch.FileReferences/filereferences.css"
          />
  </metal:styles>


  <metal:slot fill-slot="content">
    <div id="reflist-report">
      <div metal:use-macro="context/global_statusmessage/macros/portal_message">
        Status message
      </div>

      <div id="content">
        <h1 class="documentFirstHeading">
          File references report
        </h1>

        <div class="documentDescription">
          List of all file items in the site and any site content
          that link to them.
        </div>

        <div id="content-core">

            <tal:types tal:repeat="type view/file_types">
              <h2 tal:condition="python:type == 'unknown'">
                documents of unknown type
              </h2>
              <h2 tal:condition="python:type != 'unknown'">
                <span tal:content="type" /> documents
              </h2>

              <dl>
                <tal:files tal:repeat="file python:view.files[type]">
                  <dt>
                    <h3>
                      <a tal:attributes="href file/absolute_url"
                         tal:content="python:file.absolute_url().split('/')[-1]" />
                      <span class="small" tal:condition="file/Title">
                        (<span tal:replace="file/Title" />)
                      </span>
                    </h3>
                  </dt>
                  <dd tal:define="refs python:view.getReferences(file)">
                    <div tal:condition="not: refs">
                      <span class="discreet">Nothing links to this item.</span>
                    </div>

                    <tal:refs tal:condition="refs">
                      <ul tal:repeat="ref refs">
                        <li>
                          <span tal:content="ref/Title" />
                          (<a tal:attributes="href ref/absolute_url"
                              tal:content="python: '/'.join(ref.getPhysicalPath())" />)
                        </li>
                      </ul>
                    </tal:refs>
                  </dd>
                </tal:files>
              </dl>
            </tal:types>

        </div>


        <div id="options-dialog">
          <h2>Report options</h2>
          <form method="post"
                tal:attributes="action string:${context/absolute_url}/@@reflist">
            <h3>Item types to include</h3>
            <ul>
              <li>
                <input type="checkbox" name="file" id="file-type-option"
                       value="File" />
                <label for="file-type-option">Files</label>
              </li>
              <li>
                <input type="checkbox" name="image" id="image-type-option"
                       value="Image" />
                <label for="image-type-option">Images</label>
              </li>
            </ul>

            <h3>Document types to include</h3>
            <ul tal:repeat="type view/file_types">
              <li>
                <input type="checkbox"
                       tal:attributes="name  string:doc-type-${type};
                                       id    string:doc-type-${type};
                                       value type"
                       />
                <label tal:attributes="for string:doc-type-${type}"
                       tal:content="type" />
              </li>
            </ul>

            <input type="submit" name="submit" value="Update" />
          </form>
        </div>

      </div>
    </div>
  </metal:slot>
</html>
